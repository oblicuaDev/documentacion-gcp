"use strict";(globalThis.webpackChunkbilly_gcp=globalThis.webpackChunkbilly_gcp||[]).push([[2895],{8453:(e,t,n)=>{n.d(t,{R:()=>i,x:()=>s});var l=n(6540);const r={},a=l.createContext(r);function i(e){const t=l.useContext(a);return l.useMemo(function(){return"function"==typeof e?e(t):{...t,...e}},[t,e])}function s(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:i(e.components),l.createElement(a.Provider,{value:t},e.children)}},8956:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>d,contentTitle:()=>s,default:()=>x,frontMatter:()=>i,metadata:()=>l,toc:()=>c});const l=JSON.parse('{"id":"arquitectura-general","title":"\ud83d\uddfa\ufe0f Arquitectura General del Sistema Billy","description":"El proyecto Billy es una plataforma de mensajer\xeda de cobranza as\xedncrona construida sobre Google Cloud Platform (GCP), dise\xf1ada para inyectar inteligencia artificial (IA) y flexibilidad de canal en el proceso de notificaci\xf3n de facturas.","source":"@site/docs/arquitectura-general.md","sourceDirName":".","slug":"/arquitectura-general","permalink":"/documentacion-gcp/docs/arquitectura-general","draft":false,"unlisted":false,"editUrl":"https://github.com/oblicuaDev/documentacion-gcp/tree/main/docs/arquitectura-general.md","tags":[],"version":"current","frontMatter":{"id":"arquitectura-general","title":"\ud83d\uddfa\ufe0f Arquitectura General del Sistema Billy","sidebar_label":"\ud83d\uddfa\ufe0f Arquitectura General"},"sidebar":"billyGcpSidebar","previous":{"title":"\ud83d\ude80 Introducci\xf3n","permalink":"/documentacion-gcp/docs/introduccion"},"next":{"title":"Procesador Cuenti","permalink":"/documentacion-gcp/docs/funciones/get-data-from-cuenti"}}');var r=n(4848),a=n(8453);const i={id:"arquitectura-general",title:"\ud83d\uddfa\ufe0f Arquitectura General del Sistema Billy",sidebar_label:"\ud83d\uddfa\ufe0f Arquitectura General"},s="Arquitectura General del Sistema Billy GCP",d={},c=[{value:"Flujo de Procesamiento General",id:"flujo-de-procesamiento-general",level:2},{value:"1. Ingesta (Punto de Entrada)",id:"1-ingesta-punto-de-entrada",level:3},{value:"2. Orquestaci\xf3n Central (Cloud Workflows)",id:"2-orquestaci\xf3n-central-cloud-workflows",level:3},{value:"3. Procesamiento y Env\xedo (L\xf3gica de Negocio)",id:"3-procesamiento-y-env\xedo-l\xf3gica-de-negocio",level:3},{value:"Diagrama L\xf3gico Simplificado",id:"diagrama-l\xf3gico-simplificado",level:2}];function o(e){const t={code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",...(0,a.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(t.header,{children:(0,r.jsx)(t.h1,{id:"arquitectura-general-del-sistema-billy-gcp",children:"Arquitectura General del Sistema Billy GCP"})}),"\n",(0,r.jsxs)(t.p,{children:["El proyecto Billy es una plataforma de ",(0,r.jsx)(t.strong,{children:"mensajer\xeda de cobranza as\xedncrona"})," construida sobre ",(0,r.jsx)(t.strong,{children:"Google Cloud Platform (GCP)"}),", dise\xf1ada para inyectar inteligencia artificial (IA) y flexibilidad de canal en el proceso de notificaci\xf3n de facturas."]}),"\n",(0,r.jsxs)(t.p,{children:["La arquitectura se basa en un modelo ",(0,r.jsx)(t.strong,{children:"serverless"})," y de ",(0,r.jsx)(t.strong,{children:"orquestaci\xf3n centralizada"})," a trav\xe9s de Cloud Workflows."]}),"\n",(0,r.jsx)(t.h2,{id:"flujo-de-procesamiento-general",children:"Flujo de Procesamiento General"}),"\n",(0,r.jsxs)(t.p,{children:["El sistema opera en tres fases principales: ",(0,r.jsx)(t.strong,{children:"Ingesta"}),", ",(0,r.jsx)(t.strong,{children:"Orquestaci\xf3n"})," y ",(0,r.jsx)(t.strong,{children:"Procesamiento/Env\xedo"}),"."]}),"\n",(0,r.jsx)(t.h3,{id:"1-ingesta-punto-de-entrada",children:"1. Ingesta (Punto de Entrada)"}),"\n",(0,r.jsxs)(t.p,{children:["El proceso comienza cuando un usuario del ",(0,r.jsx)(t.em,{children:"frontend"})," de Oblicua inicia una tarea de cobro."]}),"\n",(0,r.jsxs)(t.table,{children:[(0,r.jsx)(t.thead,{children:(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.th,{style:{textAlign:"left"},children:"Componente"}),(0,r.jsx)(t.th,{style:{textAlign:"left"},children:"Responsabilidad"})]})}),(0,r.jsxs)(t.tbody,{children:[(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{style:{textAlign:"left"},children:(0,r.jsx)(t.strong,{children:(0,r.jsx)(t.code,{children:"ingest-task-from-billy"})})}),(0,r.jsxs)(t.td,{style:{textAlign:"left"},children:["Es el ",(0,r.jsx)(t.strong,{children:"endpoint p\xfablico"})," de la UI. Recibe el payload de la tarea (usuario, plataforma, filtros) e inmediatamente inicia el Cloud Workflow, devolviendo una respuesta 202 (Accepted)."]})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{style:{textAlign:"left"},children:(0,r.jsx)(t.strong,{children:"CORS/Seguridad"})}),(0,r.jsx)(t.td,{style:{textAlign:"left"},children:"Configurado para aceptar peticiones solo desde el dominio de Oblicua."})]})]})]}),"\n",(0,r.jsx)(t.h3,{id:"2-orquestaci\xf3n-central-cloud-workflows",children:"2. Orquestaci\xf3n Central (Cloud Workflows)"}),"\n",(0,r.jsxs)(t.p,{children:["El ",(0,r.jsx)(t.code,{children:"Billy-workflow"})," es el cerebro que coordina todas las acciones."]}),"\n",(0,r.jsxs)(t.table,{children:[(0,r.jsx)(t.thead,{children:(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.th,{style:{textAlign:"left"},children:"Componente"}),(0,r.jsx)(t.th,{style:{textAlign:"left"},children:"Responsabilidad"})]})}),(0,r.jsxs)(t.tbody,{children:[(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{style:{textAlign:"left"},children:(0,r.jsx)(t.strong,{children:(0,r.jsx)(t.code,{children:"Billy-workflow"})})}),(0,r.jsxs)(t.td,{style:{textAlign:"left"},children:["1. ",(0,r.jsx)(t.strong,{children:"Determina la Plataforma"})," de origen (Siigo, Cuenti, Sheets). ",(0,r.jsx)("br",{})," 2. ",(0,r.jsx)(t.strong,{children:"Obtiene Credenciales"})," de Secret Manager. ",(0,r.jsx)("br",{})," 3. ",(0,r.jsx)(t.strong,{children:"Invoca el Adaptador de Datos"})," (",(0,r.jsx)(t.code,{children:"get-data-from-*"}),"). ",(0,r.jsx)("br",{})," 4. ",(0,r.jsx)(t.strong,{children:"Itera"})," sobre cada factura obtenida. ",(0,r.jsx)("br",{})," 5. ",(0,r.jsx)(t.strong,{children:"Invoca"})," ",(0,r.jsx)(t.code,{children:"process-and-send-message"})," para cada factura."]})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{style:{textAlign:"left"},children:(0,r.jsx)(t.strong,{children:"Adaptadores de Datos"})}),(0,r.jsxs)(t.td,{style:{textAlign:"left"},children:[(0,r.jsx)(t.strong,{children:(0,r.jsx)(t.code,{children:"get-data-from-sheets"})}),", ",(0,r.jsx)(t.strong,{children:(0,r.jsx)(t.code,{children:"get-data-from-cuenti"})}),", ",(0,r.jsx)(t.strong,{children:(0,r.jsx)(t.code,{children:"get-data-from-siigo"})}),". Transforman datos de formatos de terceros al esquema interno de Billy."]})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{style:{textAlign:"left"},children:(0,r.jsx)(t.strong,{children:"Manejo de Errores"})}),(0,r.jsxs)(t.td,{style:{textAlign:"left"},children:["El ",(0,r.jsx)(t.em,{children:"workflow"})," maneja errores de procesamiento ",(0,r.jsx)(t.em,{children:"por factura"}),", asegurando que una factura fallida no detenga el env\xedo de las dem\xe1s."]})]})]})]}),"\n",(0,r.jsx)(t.h3,{id:"3-procesamiento-y-env\xedo-l\xf3gica-de-negocio",children:"3. Procesamiento y Env\xedo (L\xf3gica de Negocio)"}),"\n",(0,r.jsx)(t.p,{children:"Esta fase contiene la inteligencia y la decisi\xf3n final sobre el mensaje."}),"\n",(0,r.jsxs)(t.table,{children:[(0,r.jsx)(t.thead,{children:(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.th,{style:{textAlign:"left"},children:"Componente"}),(0,r.jsx)(t.th,{style:{textAlign:"left"},children:"Responsabilidad"})]})}),(0,r.jsxs)(t.tbody,{children:[(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{style:{textAlign:"left"},children:(0,r.jsx)(t.strong,{children:(0,r.jsx)(t.code,{children:"process-and-send-message"})})}),(0,r.jsxs)(t.td,{style:{textAlign:"left"},children:[(0,r.jsx)(t.strong,{children:"N\xfacleo de la L\xf3gica:"})," 1. ",(0,r.jsx)(t.strong,{children:"Genera Tono y Contenido"})," usando el Asistente de OpenAI (determina si es EMAIL, SMS, WHATSAPP, o TEMPLATE). ",(0,r.jsx)("br",{})," 2. ",(0,r.jsx)(t.strong,{children:"Ejecuta el Env\xedo"})," a trav\xe9s de las APIs externas (Campaign Monitor, sms.to, etc.). ",(0,r.jsx)("br",{})," 3. ",(0,r.jsx)(t.strong,{children:"Registra la Acci\xf3n"})," en la API de ",(0,r.jsx)(t.em,{children:"analytics"})," de Billy."]})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{style:{textAlign:"left"},children:(0,r.jsx)(t.strong,{children:(0,r.jsx)(t.code,{children:"save-user-credentials"})})}),(0,r.jsxs)(t.td,{style:{textAlign:"left"},children:[(0,r.jsx)(t.strong,{children:"Endpoint de Seguridad."})," Almacena credenciales sensibles de terceros (Siigo/Cuenti tokens) en Secret Manager de forma segura, bajo una clave \xfanica por usuario."]})]})]})]}),"\n",(0,r.jsx)(t.h2,{id:"diagrama-l\xf3gico-simplificado",children:"Diagrama L\xf3gico Simplificado"}),"\n",(0,r.jsx)(t.p,{children:"Para ilustrar el flujo de control y la interacci\xf3n de los servicios, el sistema sigue una arquitectura\nde orquestaci\xf3n impulsada por el frontend del usuario."}),"\n",(0,r.jsx)(t.p,{children:"Flujo de Billy GCP: Orquestaci\xf3n Serverless"}),"\n",(0,r.jsx)(t.p,{children:"El proceso de cobro se divide en tres etapas cr\xedticas, gestionadas por el Billy-workflow:"}),"\n",(0,r.jsxs)(t.table,{children:[(0,r.jsx)(t.thead,{children:(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.th,{style:{textAlign:"left"},children:"Paso"}),(0,r.jsx)(t.th,{style:{textAlign:"left"},children:"Componente de Orquestaci\xf3n"}),(0,r.jsx)(t.th,{style:{textAlign:"left"},children:"Invocaciones Clave"}),(0,r.jsx)(t.th,{style:{textAlign:"left"},children:"Responsabilidad"})]})}),(0,r.jsxs)(t.tbody,{children:[(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{style:{textAlign:"left"},children:"I. INGESTA"}),(0,r.jsx)(t.td,{style:{textAlign:"left"},children:"ingest-task-from-billy (Cloud Run)"}),(0,r.jsx)(t.td,{style:{textAlign:"left"},children:"Billy-workflow"}),(0,r.jsx)(t.td,{style:{textAlign:"left"},children:"Es el punto de entrada que valida la petici\xf3n del frontend de Oblicua y lanza la ejecuci\xf3n del workflow principal."})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{style:{textAlign:"left"},children:"II. DATOS Y TRANSFORMACI\xd3N"}),(0,r.jsx)(t.td,{style:{textAlign:"left"},children:"Billy-workflow (Switch)"}),(0,r.jsx)(t.td,{style:{textAlign:"left"},children:"Secret Manager & get-data-from-*"}),(0,r.jsx)(t.td,{style:{textAlign:"left"},children:"Identifica la fuente (Siigo, Cuenti, Sheets), obtiene las credenciales de Secret Manager e invoca el adaptador de datos correspondiente. El adaptador devuelve las facturas en el esquema est\xe1ndar de Billy."})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{style:{textAlign:"left"},children:"III. PROCESAMIENTO Y ENV\xcdO"}),(0,r.jsx)(t.td,{style:{textAlign:"left"},children:"Billy-workflow (Loop)"}),(0,r.jsx)(t.td,{style:{textAlign:"left"},children:"process-and-send-message"}),(0,r.jsx)(t.td,{style:{textAlign:"left"},children:"Itera sobre cada factura. La funci\xf3n llamada inyecta IA, decide el tono y canal (EMAIL, SMS, WHATSAPP) y ejecuta el env\xedo final."})]})]})]}),"\n",(0,r.jsx)(t.p,{children:"Flujo de Ejecuci\xf3n Detallado (Etapa III)"}),"\n",(0,r.jsx)(t.p,{children:"La funci\xf3n de env\xedo es el coraz\xf3n de la l\xf3gica de negocio y depende de m\xfaltiples APIs externas:"}),"\n",(0,r.jsxs)(t.ol,{children:["\n",(0,r.jsx)(t.li,{children:"Activaci\xf3n: El Billy-workflow llama a -> process-and-send-message (por cada factura)."}),"\n",(0,r.jsx)(t.li,{children:"Inteligencia Artificial: La funci\xf3n llama a -> OpenAI para generar el mensaje y determinar el canal."}),"\n",(0,r.jsx)(t.li,{children:"Registro y Env\xedo: La funci\xf3n ejecuta:\n\xa0 \xa0 * -> Campaign Monitor (para Correo Electr\xf3nico).\n\xa0 \xa0 * -> sms.to (para SMS/WhatsApp).\n\xa0 \xa0 * -> API de Registro de Billy (para guardar el log de la acci\xf3n)."}),"\n"]})]})}function x(e={}){const{wrapper:t}={...(0,a.R)(),...e.components};return t?(0,r.jsx)(t,{...e,children:(0,r.jsx)(o,{...e})}):o(e)}}}]);